<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Log In</title>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Bootstrap & Axios -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" 
        integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" 
        crossorigin="anonymous">
    </script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" 
        rel="stylesheet" 
        integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" 
        crossorigin="anonymous">

    <link rel="stylesheet" href="css/login.css">
</head>
<body>

    <div class="card">
        <form method="POST" id="sheetdb-form">
            <h1 class="title">Log-in</h1>
            <p class="subtitle">Don't have an account? <a href="create.html">Sign-up</a></p>

            <p class="or"><span>login</span></p>

            <div class="email-login">
                <label for="email">Email</label>
                <input type="email" placeholder="Enter Email" id="email" name="data[Email]" required>

                <label for="password">Password</label>
                <input type="password" placeholder="Enter Password" name="data[Password]" id="pass" required minlength="6" maxlength="16">
            </div>

            <button class="btn btn-primary"  style="width:100%; height:50px;">Log-in</button>
            <br>
            <p>Welcome back, user!</p>
        </form>
    </div>

    <script>

      const logged = localStorage.getItem("logged");
      if(logged){
        window.location.href = "index.html";
      }
document.getElementById('sheetdb-form').addEventListener("submit", function (e) {
  e.preventDefault(); 
  fun();
});

let fun = () => {
  const e = document.getElementById("email");
  const p = document.getElementById("pass");

  axios.get('https://sheetdb.io/api/v1/0qhgmvc12pifg').then(response => {
    console.warn("Response Status: " + response.status);
    console.log(response.data);
    const dat = response.data;

    let userFound = false;

    for (let i = 0; i < dat.length; i++) { 
      if (e.value === dat[i].Email && p.value === dat[i].Password) {
        // User found
        localStorage.setItem("username", dat[i].Username);
        localStorage.setItem("useremail", dat[i].Email);
        localStorage.setItem("logged", true);
        localStorage.setItem("dateJoined", dat[i].dateJoined);
        localStorage.setItem("pfp", dat[i].pfp);
        localStorage.setItem("id", dat[i].id);
        localStorage.setItem("Friends", dat[i].Friends);

        Swal.fire(
          "Logged in!",
          `Welcome ${dat[i].Username}!`,
          "success"
        ).then((result) => {
          if (result.isConfirmed) {
            window.location.href = "index.html"; 
          }
        });

        userFound = true;
        break;
      } else if (e.value === dat[i].Email && p.value !== dat[i].Password) {
        Swal.fire(
          "Oops..!",
          "Incorrect password",
          "error"
        );
        p.value = null;
        userFound = true;
        break;
      }
    }

    if (!userFound) {
      Swal.fire({
        title: "User not found!",
        icon: "info",
        text: "Don't have an account? create one!",
        confirmButtonText: "Sign-Up",
      }).then((result) => {
        if (result.isConfirmed) {
          window.location.href = "create.html";
        }
      });
      p.value = null;
      e.value = null;
    }
  });
};
</script>


</body>
</html>